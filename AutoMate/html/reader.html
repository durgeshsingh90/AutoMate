<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced File Reader</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        #editor {
            width: 100%;
            height: 65vh;
            border: 1px solid #ccc;
            margin-bottom: 0;
        }

        #statusBar {
            display: flex;
            justify-content: space-between;
            background-color: #f1f1f1;
            padding: 4px 10px;
            font-size: 12px;
            border-top: 1px solid #ccc;
        }

        .fullscreen #editor {
            height: calc(100vh - 25px);
        }

        .fullscreen #statusBar {
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 9999;
            background-color: #f1f1f1;
        }

        .status-item {
            margin: 0 5px;
        }

        .dark-mode {
            background-color: #121212;
            color: #ffffff;
        }

        .dark-mode .btn {
            background-color: #1f1f1f;
            color: #ffffff;
        }

        .dark-mode #editor {
            border-color: #333;
        }

        .dark-mode #statusBar {
            background-color: #333;
            color: #fff;
            border-top-color: #444;
        }
    </style>
</head>
<body>
    <div class="container mt-3">
        <!-- Header with buttons -->
        <div class="d-flex justify-content-between align-items-center">
            <h1 id="page-title">Advanced File Reader with Error Highlighting</h1>
            <div>
                <button id="fullscreenButton" class="btn btn-warning">Full Screen</button>
                <button id="prettierButton" class="btn btn-success">Prettier</button>
                <button id="toggleDarkMode" class="btn btn-primary">Enable Dark Mode</button>
            </div>
        </div>

        <!-- File input -->
        <input type="file" id="fileInput" class="form-control mt-3" accept=".xml,.html,.py,.json,.yaml,.yml">
        <small class="text-muted">Select a Python, JSON, YAML, XML, or HTML file to load</small>

        <!-- Monaco Editor Container -->
        <div id="editor" class="mt-3"></div>

        <!-- Status Bar -->
        <div id="statusBar">
            <span id="lnCol" class="status-item">Ln 1, Col 1</span>
            <span id="spaces" class="status-item">Spaces: 4</span>
            <span id="utf" class="status-item">UTF-8</span>
            <span id="language" class="status-item">Language: plaintext</span>
            <span id="length" class="status-item">Length: 0</span>
            <span id="lines" class="status-item">Lines: 0</span>
            <span id="selection" class="status-item">Sel: 0</span>
        </div>
    </div>

    <!-- Monaco Editor loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>
    <!-- Include js-beautify and js-yaml for formatting -->
    <script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify-html.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-beautify@1.14.0/js/lib/beautify-python.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let editor;  // Declare editor variable globally to allow theme switching

        // Load Monaco Editor
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: `# Load a Python, JSON, YAML, XML, or HTML file using the input above`,
                language: 'plaintext',
                theme: 'vs-light',
                folding: true,
                automaticLayout: true,
                scrollBeyondLastLine: false,
                lineNumbers: 'on'
            });

            // Update status bar on editor events
            editor.onDidChangeCursorPosition(updateStatusBar);
            editor.onDidChangeModelContent(updateStatusBar);
        });

        // Dark mode toggle
        document.getElementById('toggleDarkMode').addEventListener('click', function() {
            if (document.body.classList.contains('dark-mode')) {
                document.body.classList.remove('dark-mode');
                editor.updateOptions({ theme: 'vs-light' });
                this.textContent = 'Enable Dark Mode';
            } else {
                document.body.classList.add('dark-mode');
                editor.updateOptions({ theme: 'vs-dark' });
                this.textContent = 'Disable Dark Mode';
            }
        });

        // Full-screen toggle logic using the Fullscreen API
        document.getElementById('fullscreenButton').addEventListener('click', function() {
            const editorContainer = document.getElementById('editor').parentElement;
            if (!document.fullscreenElement) {
                editorContainer.requestFullscreen();
                this.textContent = 'Exit Full Screen';
            } else {
                document.exitFullscreen();
                this.textContent = 'Full Screen';
            }
        });

        // File upload logic
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const language = determineLanguage(file.name);
                monaco.editor.setModelLanguage(editor.getModel(), language);
                editor.setValue(content);
            };
            reader.readAsText(file);
        });

        // Determine language by file extension
        function determineLanguage(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            switch (ext) {
                case 'xml':
                    return 'xml';
                case 'html':
                    return 'html';
                case 'py':
                    return 'python';
                case 'json':
                    return 'json';
                case 'yaml':
                case 'yml':
                    return 'yaml';
                default:
                    return 'plaintext';
            }
        }

        // Prettier functionality with error highlighting
        document.getElementById('prettierButton').addEventListener('click', function() {
            const language = monaco.editor.getModelLanguage(editor.getModel());
            let content = editor.getValue();
            try {
                if (language === 'json') {
                    content = JSON.stringify(JSON.parse(content), null, 4);
                } else if (language === 'yaml' || language === 'yml') {
                    content = jsyaml.dump(jsyaml.load(content), { indent: 4 });
                } else if (language === 'python') {
                    content = js_beautify(content, { indent_size: 4 });
                } else {
                    throw new Error("Prettier is only available for JSON, YAML, and Python");
                }
                editor.setValue(content);
            } catch (err) {
                highlightError(err.message);
            }
        });

        // Highlight error in editor
        function highlightError(errorMessage) {
            const errorMatch = errorMessage.match(/line (\d+)/);
            if (errorMatch && errorMatch[1]) {
                const lineNumber = parseInt(errorMatch[1], 10);
                editor.deltaDecorations([], [{
                    range: new monaco.Range(lineNumber, 1, lineNumber, 1),
                    options: { isWholeLine: true, className: 'error-line' }
                }]);
                alert(`Error on line ${lineNumber}: ${errorMessage}`);
            } else {
                alert(`Error: ${errorMessage}`);
            }
        }

        // Update status bar
        function updateStatusBar() {
            const position = editor.getPosition();
            const model = editor.getModel();
            const selection = editor.getSelection();
            document.getElementById('lnCol').textContent = `Ln ${position.lineNumber}, Col ${position.column}`;
            document.getElementById('spaces').textContent = `Spaces: 4`;
            document.getElementById('utf').textContent = `UTF-8`;
            document.getElementById('language').textContent = `Language: ${monaco.editor.getModelLanguage(editor.getModel())}`;
            document.getElementById('length').textContent = `Length: ${editor.getValue().length}`;
            document.getElementById('lines').textContent = `Lines: ${model.getLineCount()}`;
            document.getElementById('selection').textContent = `Sel: ${selection.endColumn - selection.startColumn}`;
        }
    </script>

    <style>
        .error-line {
            background-color: #ffdddd !important;
        }
    </style>
</body>
</html>
