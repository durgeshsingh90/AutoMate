<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Language Comparison Editor</title>
    <link rel="stylesheet" href="https://unpkg.com/monaco-editor/min/vs/editor/editor.main.css">
    <style>
        body.light-mode {
            background-color: #f5f5f5;
            color: #333;
        }

        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        #editorContainer {
            height: 600px;
            border: 1px solid #ccc;
            margin-top: 20px;
        }

        #statusBar {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            font-family: monospace;
            font-size: 12px;
            background-color: #2c2c2c;
            color: #ffffff;
            border-top: 1px solid #444;
        }

        #darkModeToggle {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 14px;
        }

        body.light-mode #darkModeToggle {
            background-color: #ddd;
            color: #333;
        }
    </style>
</head>
<body class="light-mode">
    <button id="darkModeToggle">Dark Mode</button>
    <div id="editorContainer"></div>
    <div id="statusBar">
        <span id="languages">Languages: Unknown | Unknown</span>
        <span id="lnCl">Ln 1, Col 1</span>
        <span id="spaces">Spaces: 0</span>
        <span id="sel">Sel: 0</span>
        <span id="length">Length: 0</span>
        <span id="lines">Lines: 0</span>
    </div>

    <script src="https://unpkg.com/monaco-editor/min/vs/loader.js"></script>
    <script>
        // Track if dark mode is active
        let isDarkMode = false;

        // Function to switch between dark and light modes
        function toggleDarkMode() {
            const body = document.body;
            const darkModeToggle = document.getElementById('darkModeToggle');

            // Switch the body's class
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                darkModeToggle.textContent = 'Dark Mode';
                isDarkMode = false;

                // Set Monaco editor to light theme
                monaco.editor.setTheme('vs');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                darkModeToggle.textContent = 'Light Mode';
                isDarkMode = true;

                // Set Monaco editor to dark theme
                monaco.editor.setTheme('vs-dark');
            }

            // Optionally save the theme preference in localStorage
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        }

        // Save the content of the editors to localStorage
        function saveEditorContent(originalModel, modifiedModel) {
            localStorage.setItem('originalContent', originalModel.getValue());
            localStorage.setItem('modifiedContent', modifiedModel.getValue());
        }

        // Load content from localStorage if available
        function loadEditorContent() {
            const originalContent = localStorage.getItem('originalContent') || 'Your original code or content goes here...';
            const modifiedContent = localStorage.getItem('modifiedContent') || 'Your modified code or content goes here...';
            return { originalContent, modifiedContent };
        }

        // Language detection function
        function detectLanguage(model) {
            const languageId = monaco.editor.getModelLanguage(model);
            const languageMap = {
                'plaintext': 'Plain Text',
                'javascript': 'JavaScript',
                'typescript': 'TypeScript',
                'json': 'JSON',
                'xml': 'XML',
                'yaml': 'YAML',
                'html': 'HTML',
                'css': 'CSS',
                'python': 'Python',
                'java': 'Java',
                'csharp': 'C#',
                'cpp': 'C++',
                // Add other languages here as needed
            };
            return languageMap[languageId] || languageId;
        }

        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function() {
            const container = document.getElementById('editorContainer');

            // Load saved content from localStorage
            const { originalContent, modifiedContent } = loadEditorContent();

            // Create a diff editor with advanced settings
            const diffEditor = monaco.editor.createDiffEditor(container, {
                enableSplitView: true,
                readOnly: false,
                renderSideBySide: true,
                ignoreTrimWhitespace: false,
                originalEditable: true,
                theme: "vs",            // Default light theme (will change on toggle)
                wordWrap: "on",
                lineNumbers: "on",
                renderIndicators: true,
                renderMinimap: true
            });

            const originalModel = monaco.editor.createModel(originalContent, 'plaintext');
            const modifiedModel = monaco.editor.createModel(modifiedContent, 'plaintext');

            diffEditor.setModel({
                original: originalModel,
                modified: modifiedModel
            });

            // Status bar elements
            const languagesElement = document.getElementById('languages');
            const lnCl = document.getElementById('lnCl');
            const spaces = document.getElementById('spaces');
            const sel = document.getElementById('sel');
            const length = document.getElementById('length');
            const lines = document.getElementById('lines');

            // Function to update status bar
            function updateStatusBar(editor) {
                const position = editor.getPosition();
                const selection = editor.getSelection();
                const model = editor.getModel();

                // Update Line, Column
                lnCl.textContent = `Ln ${position.lineNumber}, Col ${position.column}`;

                // Update Spaces in current line
                const lineContent = model.getLineContent(position.lineNumber);
                const spaceCount = (lineContent.match(/ /g) || []).length;
                spaces.textContent = `Spaces: ${spaceCount}`;

                // Update Selected Text
                const selectedText = editor.getModel().getValueInRange(selection);
                sel.textContent = `Sel: ${selectedText.length}`;

                // Update Length of Selected Text
                length.textContent = `Length: ${selectedText.length}`;

                // Update Number of Lines
                lines.textContent = `Lines: ${model.getLineCount()}`;
            }

            // Function to update languages in the status bar
            function updateLanguages() {
                const originalLanguage = detectLanguage(originalModel);
                const modifiedLanguage = detectLanguage(modifiedModel);

                // Update languages in the format "Languages: original | modified"
                languagesElement.textContent = `Languages: ${originalLanguage} | ${modifiedLanguage}`;
            }

            // Save editor content on change
            originalModel.onDidChangeContent(() => {
                updateLanguages();
                saveEditorContent(originalModel, modifiedModel);
            });
            modifiedModel.onDidChangeContent(() => {
                updateLanguages();
                saveEditorContent(originalModel, modifiedModel);
            });

            // Hook into both original and modified editors to track changes
            [diffEditor.getOriginalEditor(), diffEditor.getModifiedEditor()].forEach(editor => {
                editor.onDidChangeCursorPosition(() => updateStatusBar(editor));
                editor.onDidChangeCursorSelection(() => updateStatusBar(editor));

                // Initial status bar update
                updateStatusBar(editor);
            });

            // Initially detect and update the languages
            updateLanguages();

            // Event listener for the dark mode toggle
            document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
        });
    </script>
</body>
</html>