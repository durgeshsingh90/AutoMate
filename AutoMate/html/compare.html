<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Comparison</title>
    <link rel="stylesheet" href="https://unpkg.com/monaco-editor/min/vs/editor/editor.main.css">
    <style>
        body.light-mode {
            background-color: #f5f5f5;
            color: #333;
            font-family: Arial, sans-serif;
        }

        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        h1 {
            text-align: center;
        }

        #editorContainer {
            height: calc(100vh - 100px); /* Fill the available screen height */
            display: flex;
            border: 1px solid #ccc;
            margin-top: 20px;
        }

        .editor {
            width: 50%; /* Ensure both editors fill half of the container */
            height: 100%;
        }

        #statusBar {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            font-family: monospace;
            font-size: 12px;
            background-color: #2c2c2c;
            color: #ffffff;
            border-top: 1px solid #444;
        }

        body.light-mode #statusBar {
            background-color: #f5f5f5;
            color: #333;
        }

        body.dark-mode #statusBar {
            background-color: #2c2c2c;
            color: #ffffff;
        }

        #darkModeToggle {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
        }

        body.light-mode #darkModeToggle {
            background-color: #ddd;
            color: #333;
        }
    </style>
</head>
<body class="light-mode">

    <h1>Real-time Comparison</h1>
    <button id="darkModeToggle">Dark Mode</button>
    <div id="editorContainer">
        <div id="editorOriginal" class="editor"></div>
        <div id="editorModified" class="editor"></div>
    </div>
    <div id="statusBar">
        <span id="language">Language: Unknown</span>
        <span id="tagsCount">Tags/Keys: 0</span>
        <span id="lnCl">Ln 1, Col 1</span>
    </div>

    <script src="https://unpkg.com/monaco-editor/min/vs/loader.js"></script>
    <script>
        let isDarkMode = false;

        function saveEditorContent() {
            localStorage.setItem('originalContent', originalEditor.getValue());
            localStorage.setItem('modifiedContent', modifiedEditor.getValue());
        }

        function loadEditorContent() {
            return {
                original: localStorage.getItem('originalContent') || '',
                modified: localStorage.getItem('modifiedContent') || ''
            };
        }

        function toggleDarkMode() {
            const body = document.body;
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                darkModeToggle.textContent = 'Dark Mode';
                monaco.editor.setTheme('vs');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                darkModeToggle.textContent = 'Light Mode';
                monaco.editor.setTheme('vs-dark');
            }
            isDarkMode = !isDarkMode;
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        }

        function loadThemeFromLocalStorage() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                toggleDarkMode();
            }
        }

        function detectLanguage(editor) {
            const languageMap = {
                'xml': 'xml',
                'html': 'html',
                'javascript': 'javascript',
                'json': 'json',
                'yaml': 'yaml',
                'plaintext': 'plaintext'
            };
            return editor.getModel().getLanguageId();
        }

        function countTags(text, language) {
            if (language === 'html' || language === 'xml') {
                const tagMatches = text.match(/<\/?[a-zA-Z]+>/g);
                return tagMatches ? tagMatches.length : 0;
            }
            if (language === 'json' || language === 'yaml') {
                const keyMatches = text.match(/"[^"]+":/g);
                return keyMatches ? keyMatches.length : 0;
            }
            return 0;
        }

        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            const editorContent = loadEditorContent();

            window.originalEditor = monaco.editor.create(document.getElementById('editorOriginal'), {
                value: editorContent.original,
                language: 'plaintext',
                automaticLayout: true
            });

            window.modifiedEditor = monaco.editor.create(document.getElementById('editorModified'), {
                value: editorContent.modified,
                language: 'plaintext',
                automaticLayout: true
            });

            const lnCl = document.getElementById('lnCl');
            const languageDisplay = document.getElementById('language');
            const tagsCount = document.getElementById('tagsCount');

            function updateStatusBar(editor) {
                const position = editor.getPosition();
                lnCl.textContent = `Ln ${position.lineNumber}, Col ${position.column}`;

                const language = detectLanguage(editor);
                languageDisplay.textContent = `Language: ${language}`;

                const text = editor.getValue();
                const totalTags = countTags(text, language);
                tagsCount.textContent = `Tags/Keys: ${totalTags}`;
            }

            [originalEditor, modifiedEditor].forEach(editor => {
                editor.onDidChangeCursorPosition(() => updateStatusBar(editor));
                editor.onDidChangeModelContent(() => {
                    updateStatusBar(editor);
                    saveEditorContent();
                });
                updateStatusBar(editor);
            });

            loadThemeFromLocalStorage();
        });

        document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
    </script>
</body>
</html>